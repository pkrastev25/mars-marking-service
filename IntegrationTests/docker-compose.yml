version: '3'

services:
  mongo-seed:
    image: nexus.informatik.haw-hamburg.de/mongo:3.4.1
    volumes:
      - ./SeedData:/SeedData
    entrypoint:
      - sh
    command:
      - ./SeedData/seed_data.sh
    links:
      - mongodb
    depends_on:
      - mongodb

  mongodb:
    image: nexus.informatik.haw-hamburg.de/mongo:3.4.1
    expose:
      - 27017

  metadata-svc:
    image: nexus.informatik.haw-hamburg.de/metadata-svc:22434
    links:
      - mongodb
    depends_on:
      - mongodb
    expose:
      - 8080

  marking-svc-tests:
    image: nexus.informatik.haw-hamburg.de/microsoft/dotnet:2.0.0-sdk
    environment:
      - METADATA_SVC_URL=metadata-svc:8080
    volumes:
      - ../:/mars-marking-svc
    entrypoint:
      - sh
    command:
      - ./mars-marking-svc/IntegrationTests/docker_tests_entrypoint.sh
    links:
      - mongodb
      - metadata-svc
    depends_on:
      - mongo-seed
      - mongodb
      - metadata-svc